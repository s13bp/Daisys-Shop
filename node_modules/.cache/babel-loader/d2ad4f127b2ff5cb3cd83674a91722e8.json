{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n\n          case 7:\n            op = _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n\n              _.ops.push(op);\n\n              break;\n            }\n\n            if (t[2]) _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n        }\n\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decodeSig = exports.verifySignatureWithoutPrefix = exports.verifyEIP712TypedDataSigner = exports.recoverMessageSigner = exports.recoverTransaction = exports.extractSignature = exports.encodeTransaction = exports.rlpEncodedTx = exports.getHashFromEncoded = exports.chainIdTransformationForSigning = exports.thirtyTwo = exports.sixtyFour = exports.publicKeyPrefix = void 0;\n\nvar address_1 = require(\"@celo/base/lib/address\");\n\nvar formatter_1 = require(\"@celo/connect/lib/utils/formatter\");\n\nvar sign_typed_data_utils_1 = require(\"@celo/utils/lib/sign-typed-data-utils\");\n\nvar signatureUtils_1 = require(\"@celo/utils/lib/signatureUtils\");\n\nvar debug_1 = __importDefault(require(\"debug\")); // @ts-ignore-next-line\n\n\nvar eth_lib_1 = require(\"eth-lib\");\n\nvar ethUtil = __importStar(require(\"ethereumjs-util\"));\n\nvar debug = (0, debug_1.default)('wallet-base:tx:sign'); // Original code taken from\n// https://github.com/ethereum/web3.js/blob/1.x/packages/web3-eth-accounts/src/index.js\n// 0x04 prefix indicates that the key is not compressed\n// https://tools.ietf.org/html/rfc5480#section-2.2\n\nexports.publicKeyPrefix = 0x04;\nexports.sixtyFour = 64;\nexports.thirtyTwo = 32;\n\nfunction isNullOrUndefined(value) {\n  return value === null || value === undefined;\n} // Simple replay attack protection\n// https://github.com/ethereum/EIPs/blob/master/EIPS/eip-155.md\n\n\nfunction chainIdTransformationForSigning(chainId) {\n  return chainId * 2 + 35;\n}\n\nexports.chainIdTransformationForSigning = chainIdTransformationForSigning;\n\nfunction getHashFromEncoded(rlpEncode) {\n  return eth_lib_1.hash.keccak256(rlpEncode);\n}\n\nexports.getHashFromEncoded = getHashFromEncoded;\n\nfunction trimLeadingZero(hex) {\n  while (hex && hex.startsWith('0x0')) {\n    hex = (0, address_1.ensureLeading0x)(hex.slice(3));\n  }\n\n  return hex;\n}\n\nfunction makeEven(hex) {\n  if (hex.length % 2 === 1) {\n    hex = hex.replace('0x', '0x0');\n  }\n\n  return hex;\n}\n\nfunction signatureFormatter(signature) {\n  return {\n    v: stringNumberToHex(signature.v),\n    r: makeEven(trimLeadingZero((0, address_1.ensureLeading0x)(signature.r.toString('hex')))),\n    s: makeEven(trimLeadingZero((0, address_1.ensureLeading0x)(signature.s.toString('hex'))))\n  };\n}\n\nfunction stringNumberToHex(num) {\n  var auxNumber = Number(num);\n\n  if (num === '0x' || num === undefined || auxNumber === 0) {\n    return '0x';\n  }\n\n  return eth_lib_1.bytes.fromNumber(auxNumber);\n}\n\nfunction rlpEncodedTx(tx) {\n  var _a, _b;\n\n  if (!tx.gas) {\n    throw new Error('\"gas\" is missing');\n  }\n\n  if (isNullOrUndefined(tx.chainId) || isNullOrUndefined(tx.gasPrice) || isNullOrUndefined(tx.nonce)) {\n    throw new Error('One of the values \"chainId\", \"gasPrice\", or \"nonce\" couldn\\'t be fetched: ' + JSON.stringify({\n      chainId: tx.chainId,\n      gasPrice: tx.gasPrice,\n      nonce: tx.nonce\n    }));\n  }\n\n  if (tx.nonce < 0 || tx.gas < 0 || tx.gasPrice < 0 || tx.chainId < 0) {\n    throw new Error('Gas, gasPrice, nonce or chainId is lower than 0');\n  }\n\n  var transaction = (0, formatter_1.inputCeloTxFormatter)(tx);\n  transaction.to = eth_lib_1.bytes.fromNat(tx.to || '0x').toLowerCase();\n  transaction.nonce = Number((tx.nonce !== '0x' ? tx.nonce : 0) || 0);\n  transaction.data = eth_lib_1.bytes.fromNat(tx.data || '0x').toLowerCase();\n  transaction.value = stringNumberToHex((_a = tx.value) === null || _a === void 0 ? void 0 : _a.toString());\n  transaction.feeCurrency = eth_lib_1.bytes.fromNat(tx.feeCurrency || '0x').toLowerCase();\n  transaction.gatewayFeeRecipient = eth_lib_1.bytes.fromNat(tx.gatewayFeeRecipient || '0x').toLowerCase();\n  transaction.gatewayFee = stringNumberToHex(tx.gatewayFee);\n  transaction.gasPrice = stringNumberToHex((_b = tx.gasPrice) === null || _b === void 0 ? void 0 : _b.toString());\n  transaction.gas = stringNumberToHex(tx.gas);\n  transaction.chainId = tx.chainId || 1; // This order should match the order in Geth.\n  // https://github.com/celo-org/celo-blockchain/blob/027dba2e4584936cc5a8e8993e4e27d28d5247b8/core/types/transaction.go#L65\n\n  var rlpEncode = eth_lib_1.RLP.encode([stringNumberToHex(transaction.nonce), transaction.gasPrice, transaction.gas, transaction.feeCurrency, transaction.gatewayFeeRecipient, transaction.gatewayFee, transaction.to, transaction.value, transaction.data, stringNumberToHex(transaction.chainId), '0x', '0x']);\n  return {\n    transaction: transaction,\n    rlpEncode: rlpEncode\n  };\n}\n\nexports.rlpEncodedTx = rlpEncodedTx;\n\nfunction encodeTransaction(rlpEncoded, signature) {\n  return __awaiter(this, void 0, void 0, function () {\n    var sanitizedSignature, v, r, s, rawTx, rawTransaction, hash, result;\n    return __generator(this, function (_a) {\n      sanitizedSignature = signatureFormatter(signature);\n      v = sanitizedSignature.v;\n      r = sanitizedSignature.r;\n      s = sanitizedSignature.s;\n      rawTx = eth_lib_1.RLP.decode(rlpEncoded.rlpEncode).slice(0, 9).concat([v, r, s]);\n      rawTransaction = eth_lib_1.RLP.encode(rawTx);\n      hash = getHashFromEncoded(rawTransaction);\n      result = {\n        tx: {\n          nonce: rlpEncoded.transaction.nonce.toString(),\n          gasPrice: rlpEncoded.transaction.gasPrice.toString(),\n          gas: rlpEncoded.transaction.gas.toString(),\n          to: rlpEncoded.transaction.to.toString(),\n          value: rlpEncoded.transaction.value.toString(),\n          input: rlpEncoded.transaction.data,\n          feeCurrency: rlpEncoded.transaction.feeCurrency.toString(),\n          gatewayFeeRecipient: rlpEncoded.transaction.gatewayFeeRecipient.toString(),\n          gatewayFee: rlpEncoded.transaction.gatewayFee.toString(),\n          v: v,\n          r: r,\n          s: s,\n          hash: hash\n        },\n        raw: rawTransaction\n      };\n      return [2\n      /*return*/\n      , result];\n    });\n  });\n}\n\nexports.encodeTransaction = encodeTransaction;\n\nfunction extractSignature(rawTx) {\n  var rawValues = eth_lib_1.RLP.decode(rawTx);\n  var r = rawValues[10];\n  var s = rawValues[11]; // Account.recover cannot handle canonicalized signatures\n  // A canonicalized signature may have the first byte removed if its value is 0\n\n  r = (0, address_1.ensureLeading0x)((0, address_1.trimLeading0x)(r).padStart(64, '0'));\n  s = (0, address_1.ensureLeading0x)((0, address_1.trimLeading0x)(s).padStart(64, '0'));\n  return {\n    v: rawValues[9],\n    r: r,\n    s: s\n  };\n}\n\nexports.extractSignature = extractSignature; // Recover transaction and sender address from a raw transaction.\n// This is used for testing.\n\nfunction recoverTransaction(rawTx) {\n  var rawValues = eth_lib_1.RLP.decode(rawTx);\n  debug('signing-utils@recoverTransaction: values are %s', rawValues);\n  var recovery = eth_lib_1.bytes.toNumber(rawValues[9]); // tslint:disable-next-line:no-bitwise\n\n  var chainId = eth_lib_1.bytes.fromNumber(recovery - 35 >> 1);\n  var celoTx = {\n    nonce: rawValues[0].toLowerCase() === '0x' ? 0 : parseInt(rawValues[0], 16),\n    gasPrice: rawValues[1].toLowerCase() === '0x' ? 0 : parseInt(rawValues[1], 16),\n    gas: rawValues[2].toLowerCase() === '0x' ? 0 : parseInt(rawValues[2], 16),\n    feeCurrency: rawValues[3],\n    gatewayFeeRecipient: rawValues[4],\n    gatewayFee: rawValues[5],\n    to: rawValues[6],\n    value: rawValues[7],\n    data: rawValues[8],\n    chainId: chainId\n  };\n  var r = rawValues[10];\n  var s = rawValues[11]; // Account.recover cannot handle canonicalized signatures\n  // A canonicalized signature may have the first byte removed if its value is 0\n\n  r = (0, address_1.ensureLeading0x)((0, address_1.trimLeading0x)(r).padStart(64, '0'));\n  s = (0, address_1.ensureLeading0x)((0, address_1.trimLeading0x)(s).padStart(64, '0'));\n  var signature = eth_lib_1.account.encodeSignature([rawValues[9], r, s]);\n  var extraData = recovery < 35 ? [] : [chainId, '0x', '0x'];\n  var signingData = rawValues.slice(0, 9).concat(extraData);\n  var signingDataHex = eth_lib_1.RLP.encode(signingData);\n  var signer = eth_lib_1.account.recover(getHashFromEncoded(signingDataHex), signature);\n  return [celoTx, signer];\n}\n\nexports.recoverTransaction = recoverTransaction;\n\nfunction recoverMessageSigner(signingDataHex, signedData) {\n  var dataBuff = ethUtil.toBuffer(signingDataHex);\n  var msgHashBuff = ethUtil.hashPersonalMessage(dataBuff);\n  var signature = ethUtil.fromRpcSig(signedData);\n  var publicKey = ethUtil.ecrecover(msgHashBuff, signature.v, signature.r, signature.s);\n  var address = ethUtil.pubToAddress(publicKey, true);\n  return (0, address_1.ensureLeading0x)(address.toString('hex'));\n}\n\nexports.recoverMessageSigner = recoverMessageSigner;\n\nfunction verifyEIP712TypedDataSigner(typedData, signedData, expectedAddress) {\n  var dataBuff = (0, sign_typed_data_utils_1.generateTypedDataHash)(typedData);\n  var trimmedData = dataBuff.toString('hex');\n  return verifySignatureWithoutPrefix((0, address_1.ensureLeading0x)(trimmedData), signedData, expectedAddress);\n}\n\nexports.verifyEIP712TypedDataSigner = verifyEIP712TypedDataSigner;\n\nfunction verifySignatureWithoutPrefix(messageHash, signature, signer) {\n  try {\n    (0, signatureUtils_1.parseSignatureWithoutPrefix)(messageHash, signature, signer);\n    return true;\n  } catch (error) {\n    return false;\n  }\n}\n\nexports.verifySignatureWithoutPrefix = verifySignatureWithoutPrefix;\n\nfunction decodeSig(sig) {\n  var _a = eth_lib_1.account.decodeSignature(sig),\n      v = _a[0],\n      r = _a[1],\n      s = _a[2];\n\n  return {\n    v: parseInt(v, 16),\n    r: ethUtil.toBuffer(r),\n    s: ethUtil.toBuffer(s)\n  };\n}\n\nexports.decodeSig = decodeSig;","map":{"version":3,"mappings":"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","names":["debug","exports","isNullOrUndefined","value","undefined","chainIdTransformationForSigning","chainId","getHashFromEncoded","rlpEncode","eth_lib_1","keccak256","trimLeadingZero","hex","startsWith","slice","makeEven","length","replace","signatureFormatter","signature","v","stringNumberToHex","r","toString","s","num","auxNumber","Number","fromNumber","rlpEncodedTx","tx","gas","Error","gasPrice","nonce","JSON","stringify","transaction","to","fromNat","toLowerCase","data","_a","feeCurrency","gatewayFeeRecipient","gatewayFee","_b","encode","encodeTransaction","rlpEncoded","sanitizedSignature","rawTx","decode","concat","rawTransaction","hash","result","input","raw","extractSignature","rawValues","padStart","recoverTransaction","recovery","toNumber","celoTx","parseInt","encodeSignature","extraData","signingData","signingDataHex","signer","recover","recoverMessageSigner","signedData","dataBuff","ethUtil","toBuffer","msgHashBuff","hashPersonalMessage","fromRpcSig","publicKey","ecrecover","address","pubToAddress","verifyEIP712TypedDataSigner","typedData","expectedAddress","trimmedData","verifySignatureWithoutPrefix","messageHash","error","decodeSig","sig","decodeSignature"],"sourceRoot":"","sources":["../src/signing-utils.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}